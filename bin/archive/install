#!/bin/bash

# Set paths for Intel Mac
export HOMEBREW_PREFIX="/usr/local"
export HOMEBREW_REPOSITORY="/usr/local/Homebrew"

sudo mkdir -p "${HOMEBREW_REPOSITORY}"
sudo mkdir -p "${HOMEBREW_PREFIX}"/{bin,etc,include,lib,sbin,share,var,opt,Frameworks,Cellar,var/homebrew/linked}

# shellcheck disable=SC2312
sudo chown -R "$(whoami)":wheel "${HOMEBREW_REPOSITORY}" "${HOMEBREW_PREFIX}"/{bin,etc,include,lib,sbin,share,var,opt,Frameworks,Cellar,var/homebrew/linked}

# Clone from your local repository
git clone --depth=1 file:///Volumes/Monterey/repos/homebrew /usr/local/Homebrew
cd /usr/local/Homebrew || exit
git config advice.detachedHead false
cd || exit

# Create symlink
sudo ln -s /usr/local/Homebrew/bin/brew /usr/local/bin/

# Add to PATH (if not already there)
if [[ ! "${PATH}" =~ "/usr/local/bin" ]]; then
	# shellcheck disable=SC2016
	echo 'export PATH="/usr/local/bin:${PATH}"' >>~/.zshrc
fi

cat /Volumes/Monterey/zshrc.example >>~/.zshrc